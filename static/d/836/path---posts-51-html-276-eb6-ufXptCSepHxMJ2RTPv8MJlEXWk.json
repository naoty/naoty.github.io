{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"Circle CIからHeroku registryにpushする","time":"2018-12-16T22:44:00+0900","description":null,"tags":["circleci"]},"html":"<p>DockerコンテナをHeroku上で実行したい場合、Heroku registryにDockerイメージをpushすることになる。これをCircle CIで行いたい。</p>\n<p>Heroku registryの認証はHeroku CLIか<code>docker login</code>コマンドで行うことができるが、Heroku CLIのセットアップを\"Docker in Docker\"イメージ（ベースがalpine）上で行うのはけっこうたいへんなので、以下のように<code>docker login</code>コマンドから行うと良い。</p>\n<pre><code class=\"language-bash\">$ docker login -u _ -p $HEROKU_API_KEY registry.heroku.com\n</code></pre>\n<p><code>$HEROKU_API_KEY</code>は<code>heroku auth:token</code>コマンドで取得したトークンを環境変数で設定しておく。</p>\n<p><code>.circle/config.yml</code>はこんな感じになる。</p>\n<pre><code class=\"language-yaml\">steps:\n  # ...\n  - deploy:\n      name: Push image to Heroku registry\n      command: |\n        docker login -u _ -p $HEROKU_API_KEY registry.heroku.com\n        docker tag myapp registry.heroku.com/$HEROKU_APP/web/myapp\n        docker push registry.heroku.com/$HEROKU_APP/web/myapp\n</code></pre>","fileAbsolutePath":"/home/circleci/project/contents/posts/51.md"}},"pageContext":{"id":"17c048f6-07b2-53d8-80e9-5baa4c9498dd"}}
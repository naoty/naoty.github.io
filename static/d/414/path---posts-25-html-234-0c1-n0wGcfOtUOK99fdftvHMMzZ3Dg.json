{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"webpackerにjestを導入する","time":"2018-03-20T19:56:00+0900","description":null,"tags":["rails"]},"html":"<p>webpackerを使ったRailsプロジェクトにjestを導入してみた。jestをインストールしてテストを実行してみると、以下のようなエラーがおきた。</p>\n<pre><code>({\"Object.&#x3C;anonymous>\":function(module,exports,require,__dirname,__filename,global,jest){import xxx from './xxx';\n                                                                                         ^^^^^^\n\nSyntaxError: Unexpected token import\n  at ScriptTransformer._transformAndBuildScript (node_modules/jest-runtime/build/script_transformer.js:316:17)\n</code></pre>\n<p>importがコンパイルできていないようだ。webpackerが生成する<code>.babelrc</code>では、以下のように設定されている。</p>\n<pre><code class=\"language-json\">{\n  \"presets\": [\n    [\"env\", {\n      \"modules\": false,\n      \"targets\": {\n        \"browsers\": \"> 1%\",\n        \"uglify\": true\n      },\n      \"useBuiltIns\": true\n    }],\n    \"react\"\n  ]\n}\n</code></pre>\n<p><code>\"modules\": false</code>と設定されているため、<code>import</code>の変換が行われないようになっている。これはwebpackによって<code>import</code>文を処理するためにbabelでは<code>import</code>の変換を行わないようにしているんだと思う。</p>\n<p>しかし、jestを実行する場合はwebpackによる処理は行われないため、<code>import</code>が変換されずエラーになっていたと考えられそう。</p>\n<p>そこで、以下の設定を<code>.babelrc</code>に追加したところ直った。</p>\n<pre><code class=\"language-json\">{\n  \"env\": {\n    \"test\": {\n      \"presets\": [\n        [\"env\", { \"modules\": \"commonjs\" }]\n      ]\n    }\n  }\n}\n</code></pre>\n<p>jestは実行時に自動的に<code>NODE_ENV</code>を<code>test</code>に設定するため、これでうまくいく。</p>","fileAbsolutePath":"/Users/naoty/src/github.com/naoty/homepage/contents/posts/25.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"43c66135-4cdd-52b9-80d1-7452474832ad"}}
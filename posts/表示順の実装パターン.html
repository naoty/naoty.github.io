<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=content-width,initial-scale=1"><title>naoty.github.io</title><link rel="stylesheet" href="../homepage.css"></head><body><div class="container"><main><article><header class="post-header"><h1 class="post-title">表示順の実装パターン</h1><p class="post-metadata">公開：<time datetime="2017-11-18T02:45:19.000Z">2017/11/18 11:45:19</time></p></header><section class="post-content"><p>何かを表示する際に表示順を運営側で指定したいという要件がよくある。それはプロモーション的なモチベーションだったり、政治的なモチベーションだったりする。</p><p><code>display_order</code>みたいなカラムを作る。間違っても<code>order</code>というカラムを作ってはいけない。予約語をカラム名として使うと意図しないエラーが起きる。</p><p><code>NULL</code>を許容するかどうかは仕様による。許容する場合、<code>NULL</code>を先頭に出すか末尾に出すか決める必要がある。デフォルトでは<code>NULL</code>は最小値として扱われ、<code>ASC</code>だと先頭に来る。</p><p>次に繰り下げの実装が必要だ。厳密にやるなら繰り上げも必要だろう。あるデータの表示順が更新されたら、同じ表示順をもつデータを繰り下げなくてはいけない。繰り下げは連鎖的に起こる。</p><h1 id="postgresql-">PostgreSQLの照合順序</h1><ul><li>照合順序（collation）とは文字の並び順のこと。</li><li>照合順序を適切に設定しないと、文字列のソートがうまくいかない。</li><li>照合順序を指定するには、<code>ORDER</code>句と共に指定するか、スキーマに指定するか、データベースの作成時に指定する。</li></ul><h1 id="null-order-by">NULLを含む列のORDER BY</h1><p><code>ASC</code>の場合、<code>NULL</code>は先頭に来る。<code>NULL</code>を最後に並べたい場合は以下のように書く。</p><pre><code class="lang-sql">-- MySQL
SELECT * FROM doctors ORDER BY display_order IS NULL ASC;

-- PostgreSQL
SELECT * FROM doctors ORDER BY display_order ASC NULLS LAST;
</code></pre></section></article></main><footer><p>© 2017 Naoto Kaneko</p></footer></div></body></html>
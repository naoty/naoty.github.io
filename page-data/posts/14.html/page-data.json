{"componentChunkName":"component---src-templates-post-jsx","path":"/posts/14.html","webpackCompilationHash":"c1847432cbcf5c1203c1","result":{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"スキーマファイルをSQL形式に変更する","time":"2018-01-13T09:53:00+0900","description":"スキーマファイルのと実際のスキーマの乖離を避けるためSQL形式に変更する","tags":["rails"]},"html":"<p>Railsアプリのスキーマファイルはデータベースの現在のスキーマを表し、デフォルトでは<code class=\"language-text\">db/schema.rb</code>にActiveRecordのDSLで記述されている。スキーマファイルは<code class=\"language-text\">rails db:schema:dump</code>で生成されるものなので、開発者が直接いじってはならない。</p>\n<p>開発が進みデータベースのスキーマが複雑になると、ActiveRecordのDSLでの表現に限界が出てくる。DSLのメリットはデータベースに依存せず抽象的な表現ができることだが、データベース固有の設定をする場合にDSLで表現できなくなってくる。</p>\n<p>DSLで表現できなくなるとスキーマファイルと実際のスキーマに乖離が生まれる。スキーマに乖離があると、開発環境やCI上でデータベースをセットアップするのが困難になる。</p>\n<p>そこで、ActiveRecordはスキーマファイルの形式にSQLを選ぶことができる。<code class=\"language-text\">config/application.rb</code>で以下のように指定すると、<code class=\"language-text\">db/structure.sql</code>というSQL形式のスキーマファイルが生成される。</p>\n<div class=\"gatsby-highlight\" data-language=\"rb\"><pre class=\"language-rb\"><code class=\"language-rb\">config<span class=\"token punctuation\">.</span>active_record<span class=\"token punctuation\">.</span>schema_format <span class=\"token operator\">=</span> <span class=\"token symbol\">:sql</span></code></pre></div>\n<p>なお、この設定はデフォルトでは<code class=\"language-text\">:ruby</code>が指定されている。</p>\n<p>SQL形式に変更した場合、コマンドを以下のように変える必要がある。</p>\n<table>\n<thead>\n<tr>\n<th>Ruby形式</th>\n<th>SQL形式</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">rails db:schema:load</code></td>\n<td><code class=\"language-text\">rails db:structure:load</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">rails db:schema:dump</code></td>\n<td><code class=\"language-text\">rails db:structure:dump</code></td>\n</tr>\n</tbody>\n</table>\n<p>また、<code class=\"language-text\">db/structure.sql</code>の生成にはDBごとのスキーマダンプツールを使うため、MySQLであれば<code class=\"language-text\">mysqldump</code>を用意する必要がある。</p>","fileAbsolutePath":"/home/circleci/project/contents/posts/14.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"b435a441-33fe-5b74-9eba-4e500a4eb433"}}}
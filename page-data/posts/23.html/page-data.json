{"componentChunkName":"component---src-templates-post-jsx","path":"/posts/23.html","webpackCompilationHash":"584539bd991eb8ba3f1e","result":{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"Assets precompileに必要最小限のファイル","time":"2018-03-09T20:55:00+0900","description":null,"tags":["rails","docker"]},"html":"<p>Dockerfileで<code class=\"language-text\">rails assets:precompile</code>を実行する前に<code class=\"language-text\">COPY</code>するファイルを必要最小限にしておけると、キャッシュを有効活用できてビルド時間を短縮できる。</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">WORKDIR</span> /myapp\n\n<span class=\"token keyword\">COPY</span> app/assets /myapp/\n<span class=\"token keyword\">COPY</span> bin/rails /myapp/bin/\n<span class=\"token keyword\">COPY</span> config/environments /myapp/config/environments/\n<span class=\"token keyword\">COPY</span> config/initializers /myapp/config/initializers/\n<span class=\"token keyword\">COPY</span> config/application.rb /myapp/config/application.rb\n<span class=\"token keyword\">COPY</span> config/boot.rb /myapp/config/boot.rb\n<span class=\"token keyword\">COPY</span> config/environment.rb /myapp/config/environment.rb\n<span class=\"token keyword\">COPY</span> config/secrets.yml.enc /myapp/config/secrets.yml.enc\n<span class=\"token keyword\">COPY</span> lib/assets /myapp/lib/assets/\n<span class=\"token keyword\">COPY</span> vendor/assets /myapp/vendor/assets/\n<span class=\"token keyword\">COPY</span> Rakefile /myapp/\n<span class=\"token keyword\">RUN</span> bin/rails assets<span class=\"token punctuation\">:</span>precompile</code></pre></div>\n<p>とりあえずこれだけで動いた。<code class=\"language-text\">config/initializers/</code>以下も削れそうな気がするけど、プロジェクトによってケースバイケースだと思うので、これで十分だとおもう。</p>","fileAbsolutePath":"/home/circleci/project/contents/posts/23.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"663095e2-fca2-5fdf-b605-8d2fac7643f6"}}}
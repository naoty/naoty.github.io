{"componentChunkName":"component---src-templates-post-jsx","path":"/posts/24.html","webpackCompilationHash":"851492ffdd5ee5aba361","result":{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"bin/webpackに必要最小限のファイル","time":"2018-03-13T21:22:00+0900","description":null,"tags":["rails","docker"]},"html":"<p><a href=\"https://naoty.github.io/posts/23.html\">前回</a>と同様にwebpackerによるbundleに必要最小限なファイルの<code class=\"language-text\">COPY</code>を試してみた。</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">FROM</span> starefossen/ruby<span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">:</span>2<span class=\"token punctuation\">-</span>8<span class=\"token punctuation\">-</span>alpine\n<span class=\"token keyword\">WORKDIR</span> /myapp\n\n<span class=\"token keyword\">COPY</span> app/javascript /myapp/app/javascript/\n<span class=\"token keyword\">COPY</span> bin/webpack /myapp/bin/\n<span class=\"token keyword\">COPY</span> config/webpack /myapp/config/webpack/\n<span class=\"token keyword\">COPY</span> config/webpacker.yml /myapp/config/webpacker.yml\n<span class=\"token keyword\">COPY</span> .babelrc .postcssrc.yml /myapp/\n<span class=\"token keyword\">COPY</span> Gemfile Gemfile.lock /myapp/\n<span class=\"token keyword\">COPY</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>from=bundler /usr/local/bundle /usr/local/bundle\n<span class=\"token keyword\">RUN</span> bin/webpack</code></pre></div>\n<ul>\n<li>webpackerを使うにはRubyとNodeの両方が必要になるため両方が入ったベースイメージを探したところ、<a href=\"https://hub.docker.com/r/starefossen/ruby-node/\">starefossen/ruby-node</a>がよさそうだった。</li>\n<li><code class=\"language-text\">COPY --from=bundler</code>としているところは、<a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\">multi-stage build</a>を使っている。前段のビルドで<code class=\"language-text\">bundle install</code>しておいたものを<code class=\"language-text\">COPY</code>している。こうすることで実行時には不要なものを除くことができる。このビルド自体もRailsを起動するために必要なファイルを生成するビルドにすぎない。</li>\n</ul>","fileAbsolutePath":"/home/circleci/project/contents/posts/24.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"eaa6c41b-7c09-5ffb-a736-11d68e83c34b"}}}
{"componentChunkName":"component---src-templates-post-jsx","path":"/posts/25.html","webpackCompilationHash":"b07fc910211381608a11","result":{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"webpackerにjestを導入する","time":"2018-03-20T19:56:00+0900","description":null,"tags":["rails"]},"html":"<p>webpackerを使ったRailsプロジェクトにjestを導入してみた。jestをインストールしてテストを実行してみると、以下のようなエラーがおきた。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">({&quot;Object.&lt;anonymous&gt;&quot;:function(module,exports,require,__dirname,__filename,global,jest){import xxx from &#39;./xxx&#39;;\n                                                                                         ^^^^^^\n\nSyntaxError: Unexpected token import\n  at ScriptTransformer._transformAndBuildScript (node_modules/jest-runtime/build/script_transformer.js:316:17)</code></pre></div>\n<p>importがコンパイルできていないようだ。webpackerが生成する<code class=\"language-text\">.babelrc</code>では、以下のように設定されている。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">\"env\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"modules\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"targets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"browsers\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"> 1%\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"uglify\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"useBuiltIns\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"react\"</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">&quot;modules&quot;: false</code>と設定されているため、<code class=\"language-text\">import</code>の変換が行われないようになっている。これはwebpackによって<code class=\"language-text\">import</code>文を処理するためにbabelでは<code class=\"language-text\">import</code>の変換を行わないようにしているんだと思う。</p>\n<p>しかし、jestを実行する場合はwebpackによる処理は行われないため、<code class=\"language-text\">import</code>が変換されずエラーになっていたと考えられそう。</p>\n<p>そこで、以下の設定を<code class=\"language-text\">.babelrc</code>に追加したところ直った。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">\"env\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">\"modules\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commonjs\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>jestは実行時に自動的に<code class=\"language-text\">NODE_ENV</code>を<code class=\"language-text\">test</code>に設定するため、これでうまくいく。</p>","fileAbsolutePath":"/home/circleci/project/contents/posts/25.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"30d04f77-654e-55e3-88ee-1dcf05b2ee2d"}}}
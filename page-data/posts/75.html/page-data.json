{"componentChunkName":"component---src-templates-post-jsx","path":"/posts/75.html","webpackCompilationHash":"12bcd1ad9018fe69dd60","result":{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"mrubyã®åˆæ‰‹","time":"2019-08-07T12:06:00+0900","description":null,"tags":["mruby"]},"html":"<p>ç’°å¢ƒæ§‹ç¯‰ã‹ã‚‰mrubyã‚’å®Ÿè¡Œã™ã‚‹Cã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¾ã§ã€‚</p>\n<h1>ç’°å¢ƒæ§‹ç¯‰</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> hello-mruby\n$ <span class=\"token builtin class-name\">cd</span> hello-mruby\n$ <span class=\"token function\">vi</span> Dockerfile</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token inserted-sign inserted\">+FROM ruby:1.9\n+RUN apt update &amp;&amp; \\\n+  apt install -y bison --no-install-recommends &amp;&amp; \\\n+  git clone https://github.com/mruby/mruby &amp;&amp; \\\n+  cd mruby &amp;&amp; \\\n+  ./minirake\n+ENV PATH /mruby/bin:$PATH\n+CMD [\"bash\"]</span></code></pre></div>\n<ul>\n<li><a href=\"https://github.com/mruby/mruby/blob/master/doc/guides/compile.md#prerequisites\">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã‚’èª­ã‚€ã¨ã€mrubyã®ãƒ“ãƒ«ãƒ‰ã«ã¯Ruby 1.8ã‹1.9ã€gccã€arã€bisonãŒå¿…è¦ã¨ã®ã“ã¨ã ã£ãŸã€‚<code class=\"language-text\">ruby:1.9</code>ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã€å…¥ã£ã¦ãªã‹ã£ãŸbisonã ã‘ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã€‚</li>\n<li><code class=\"language-text\">./minirake</code>ã§mrubyãŒãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ã€‚<code class=\"language-text\">bin/</code>ä»¥ä¸‹ã«mrbcãªã©ãŒã‚ã‚‹ã®ã§<code class=\"language-text\">PATH</code>ã«è¿½åŠ ã—ã¦ãŠãã€‚</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker build <span class=\"token builtin class-name\">.</span> -t naoty/hello-mruby\n$ docker run -it --rm naoty/hello-mruby\n% mirb\nmirb - Embeddable Interactive Ruby Shell\n\n<span class=\"token operator\">></span> MRUBY_VERSION\n <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token string\">\"2.0.1\"</span>\n<span class=\"token operator\">></span> <span class=\"token builtin class-name\">exit</span>\n% <span class=\"token builtin class-name\">exit</span></code></pre></div>\n<ul>\n<li>Dockerã§mrubyã‚’ãƒ“ãƒ«ãƒ‰ã§ããŸã“ã¨ã‚’ç¢ºèªã—ãŸã€‚</li>\n</ul>\n<h1>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">vi</span> Dockerfile</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"> FROM ruby:1.9\n RUN apt update &amp;&amp; \\\n   apt install -y bison --no-install-recommends &amp;&amp; \\\n   git clone https://github.com/mruby/mruby &amp;&amp; \\\n   cd mruby &amp;&amp; \\\n   ./minirake\n ENV PATH /mruby/bin:$PATH\n</span><span class=\"token inserted-sign inserted\">+WORKDIR /hello-mruby\n+COPY . /hello-mruby/\n</span><span class=\"token unchanged\"> CMD [\"bash\"]</span></code></pre></div>\n<ul>\n<li>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã¦ã„ãã®ã§<code class=\"language-text\">WORKDIR</code>ã‚’ç”¨æ„ã™ã‚‹ã€‚</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">vi</span> hello.rb</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token inserted-sign inserted\">+puts \"Hello, mruby!\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker build <span class=\"token builtin class-name\">.</span> -t naoty/hello-mruby</code></pre></div>\n<ul>\n<li>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã«è¿½åŠ ã™ã‚‹ã€‚</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker run -it --rm -v <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>:/hello-mruby naoty/hello-mruby\n% mrbc hello.rb\n% <span class=\"token builtin class-name\">exit</span></code></pre></div>\n<ul>\n<li>ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’èµ·å‹•ã™ã‚‹ã€‚</li>\n<li>mrbcã§<code class=\"language-text\">hello.rb</code>ã‹ã‚‰<code class=\"language-text\">hello.mrb</code>ã‚’ç”Ÿæˆã™ã‚‹ã€‚ãƒã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ã®ã§ã€ãƒ›ã‚¹ãƒˆã«ã‚‚<code class=\"language-text\">hello.mrb</code>ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã€‚</li>\n</ul>\n<h1>Cã‹ã‚‰mrubyã‚’å®Ÿè¡Œã™ã‚‹</h1>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">vi</span> hello.c</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token inserted-sign inserted\">+#include &lt;mruby.h>\n+#include &lt;mruby/dump.h>\n+#include &lt;stdio.h>\n+\n+int main() {\n+  mrb_state *mrb = mrb_open();\n+\n+  FILE *fd = fopen(\"hello.mrb\", \"r\");\n+  mrb_load_irep_file(mrb, fd);\n+\n+  mrb_close(mrb);\n+\n+  return 0;\n+}</span></code></pre></div>\n<ul>\n<li>ç”Ÿæˆã—ãŸ<code class=\"language-text\">hello.mrb</code>ã‚’å®Ÿè¡Œã™ã‚‹Cã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€‚</li>\n<li>Cã®ã‚³ãƒ¼ãƒ‰ã¯é›°å›²æ°—ã§æ›¸ã„ã¦ã‚‹ã‘ã©ã€<code class=\"language-text\">mrb_open</code>ã¨<code class=\"language-text\">mrb_close</code>ã¯ãŠç´„æŸã¿ãŸã„ã§ã€<code class=\"language-text\">mrb_load_irep_file</code>ã«ã‚ˆã£ã¦mrbãƒ•ã‚¡ã‚¤ãƒ«ã‚’<code class=\"language-text\">load</code>ã™ã‚‹ã£ã½ã„ã€‚</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker run -it --rm -v <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>:/hello-mruby naoty/hello-mruby\n% gcc hello.c -I/mruby/include -L/mruby/build/host/lib -lmruby -lm -o hello\n% ./hello\nHello, mruby<span class=\"token operator\">!</span></code></pre></div>\n<ul>\n<li>æ›¸ã„ãŸCã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã€ã‚‚ã†ä¸€åº¦Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’èµ·å‹•ã™ã‚‹ã€‚</li>\n<li><code class=\"language-text\">hello.c</code>ã‚’<code class=\"language-text\">gcc</code>ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã«ã¯ã€ã¾ãšãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«<code class=\"language-text\">mruby.h</code>ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚mrubyã®ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã¯<code class=\"language-text\">/mruby/include/</code>ä»¥ä¸‹ã«ã‚ã‚‹ã®ã§ã€<code class=\"language-text\">-I</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã—ã¦ã„ã‚‹ã€‚</li>\n<li>æ¬¡ã«ã€mrubyæœ¬ä½“ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ã¨ã‚‚ã«<code class=\"language-text\">hello.c</code>ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚mrubyã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯<code class=\"language-text\">/mruby/build/host/lib/libmruby.a</code>ãªã®ã§ã€<code class=\"language-text\">-L</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã€<code class=\"language-text\">-l</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§<code class=\"language-text\">mruby</code>ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã€‚</li>\n<li>ã¾ãŸã€ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨<code class=\"language-text\">/mruby/src/numeric.c:321: undefined reference to &#39;round&#39;</code>ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã†ã€‚Mathã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¶³ã‚Šãªã•ãã†ãªã®ã§ã€<code class=\"language-text\">-lm</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦<code class=\"language-text\">libm.so</code>ã‚’ãƒªãƒ³ã‚¯ã—ã¦ã„ã‚‹ã€‚</li>\n<li>ç„¡äº‹ã«ãƒ“ãƒ«ãƒ‰ã§ããŸå®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã€<code class=\"language-text\">hello.rb</code>ã§æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸã€‚</li>\n</ul>\n<hr>\n<h1>è¿½è¨˜</h1>\n<blockquote class=\"twitter-tweet\"><p lang=\"ja\" dir=\"ltr\">Rubyã¯æœ€æ–°ã§å•é¡Œãªã„ã§ã™ï¼å•é¡ŒãŒã‚ã‚Œã°ç›´ã™ã¹ããªã®ã§1.9ã¯ã‚„ã‚ã¾ã—ã‚‡ã†â€¦ / 1ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆ <a href=\"https://t.co/uu6C7Y3g0k\">https://t.co/uu6C7Y3g0k</a> â€œmrubyã®åˆæ‰‹â€ (1 user) <a href=\"https://t.co/2bFP5uPQAu\">https://t.co/2bFP5uPQAu</a></p>&mdash; Uchio KONDO ğŸ”« (@udzura) <a href=\"https://twitter.com/udzura/status/1158943027215253510?ref_src=twsrc%5Etfw\">August 7, 2019</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<blockquote class=\"twitter-tweet\" data-conversation=\"none\"><p lang=\"ja\" dir=\"ltr\">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ(docs/guides/compile.md) ã‚’ã€Œ2.0 or laterã€ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã™</p>&mdash; Yukihiro Matsumoto (@yukihiro_matz) <a href=\"https://twitter.com/yukihiro_matz/status/1159001970536923137?ref_src=twsrc%5Etfw\">August 7, 2019</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n<p>ã¨ã®ã“ã¨ãªã®ã§ã€ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’<code class=\"language-text\">ruby:2.6</code>ã«ã—ã¦ã¿ãŸã‘ã©å•é¡Œãªãä¸Šè¨˜ã®æ‰‹é †ãŒã§ããŸã€‚</p>","fileAbsolutePath":"/home/circleci/project/contents/posts/75.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"672094a7-342b-5109-b72b-de161552221b"}}}
{"componentChunkName":"component---src-templates-post-jsx","path":"/posts/22.html","webpackCompilationHash":"13ca262fa2a6f57ab7f5","result":{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"JSONをASCIIテーブルで表示する","time":"2018-03-05T17:34:00+0900","description":"naoty/tableにJSONをASCIIテーブルに表示する機能を追加した","tags":null},"html":"<p>もともとTSV形式の文字列をASCIIやMarkdown形式のテーブルに変換するコマンドだった<a href=\"https://github.com/naoty/table\">naoty/table</a>を改善して、JSON形式の文字列を受け取れるようにした。</p>\n<p>例えば、以下のようなJSONファイルがあったとする。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// pokemons.json</span>\n<span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"bulbasaur\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ivysaur\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"venusaur\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>このとき、以下のようにパイプで<code class=\"language-text\">table</code>コマンドに渡すとASCII形式に変換できる。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">cat</span> pokemons.json <span class=\"token operator\">|</span> table -f json:ascii\n+----+-----------+\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span> <span class=\"token operator\">|</span> name      <span class=\"token operator\">|</span>\n+----+-----------+\n<span class=\"token operator\">|</span> 1  <span class=\"token operator\">|</span> bulbasaur <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 2  <span class=\"token operator\">|</span> ivysaur   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 3  <span class=\"token operator\">|</span> venusaur  <span class=\"token operator\">|</span>\n+----+-----------+</code></pre></div>\n<p><code class=\"language-text\">table</code>コマンドは出力フォーマットとしてMarkdown形式のテーブルも選べるので、以下のように出力できる。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">cat</span> pokemons.json <span class=\"token operator\">|</span> table -f json:markdown\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span> <span class=\"token operator\">|</span> name      <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> -- <span class=\"token operator\">|</span> --------- <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 1  <span class=\"token operator\">|</span> bulbasaur <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 2  <span class=\"token operator\">|</span> ivysaur   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> 3  <span class=\"token operator\">|</span> venusaur  <span class=\"token operator\">|</span></code></pre></div>\n<h1>モチベーション</h1>\n<p>最近、AWSの作業をすることが増えてAWS CLIから返ってくるJSONを扱うことが増えた。返ってきたJSONを<code class=\"language-text\">jq</code>コマンドで整形して表示するのだけど、件数が増えるとかなり見にくかった。そこで、このような機能を追加してASCIIテーブルとして見やすくしたかったので追加してみた。</p>\n<p>例えば、ECSのあるタスク定義に含まれるイメージを知りたいとき、こんな感じでやることになりそう。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ aws ecs describe-task-definition --task-definition hello_world:8 <span class=\"token operator\">|</span> \\\n  jq <span class=\"token string\">\".taskDefinition.containerDefinitions | map({name: .name, image: .image})\"</span> <span class=\"token operator\">|</span> \\\n  table -f json:ascii\n+-----------+-----------+\n<span class=\"token operator\">|</span> name      <span class=\"token operator\">|</span> image     <span class=\"token operator\">|</span>\n+-----------+-----------+\n<span class=\"token operator\">|</span> wordpress <span class=\"token operator\">|</span> wordpress <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> mysql     <span class=\"token operator\">|</span> mysql     <span class=\"token operator\">|</span>\n+-----------+-----------+</code></pre></div>","fileAbsolutePath":"/home/circleci/project/contents/posts/22.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"f9a943d8-b86e-5fa5-b169-f2d9a77faf78"}}}
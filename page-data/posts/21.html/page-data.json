{"componentChunkName":"component---src-templates-post-jsx","path":"/posts/21.html","webpackCompilationHash":"8e794c7d7dccde6ae001","result":{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"MailHogによるメールの受信確認","time":"2018-02-18T21:53:00+0900","description":"コンテナ中心の開発環境ではMailHogを使ってメールの受信確認を行うのが便利だった","tags":["docker"]},"html":"<p>メール送信機能を開発する際、メールの受信を確認したい。従来のRailsアプリ開発では、<a href=\"https://github.com/ryanb/letter_opener\">letter_opener</a>のようなライブラリを使っていた。</p>\n<p>現在のコンテナを中心とした開発環境では、Railsの外側にSMTPサーバーのコンテナを用意し、環境変数によって接続先を設定する方法が一般的ではないかと思った。調べてみると、<a href=\"https://github.com/mailhog/MailHog\">MailHog</a>というツールが見つかった。MailHogはSMTPサーバーであり、かつ受信したメールを確認できるHTTPサーバーも兼ね備えている。</p>\n<p>MailHogはDocker Hubでコンテナを公開しているため、docker-composeを使うと簡単に開発環境に組み込むことができる。</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># docker-compose.yml</span>\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> .\n    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> bin/rails s <span class=\"token punctuation\">-</span>p 3000 <span class=\"token punctuation\">-</span>b 0.0.0.0\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">SMTP_HOST</span><span class=\"token punctuation\">:</span> mail\n      <span class=\"token key atrule\">SMTP_PORT</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1025</span>\n    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> mail\n  <span class=\"token key atrule\">mail</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mailhog/mailhog\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> 8025<span class=\"token punctuation\">:</span><span class=\"token number\">8025</span></code></pre></div>\n<p>Railsではこんな感じで環境変数によってメールの送信先を設定するだけでいい。</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># application.rb</span>\nconfig<span class=\"token punctuation\">.</span>action_mailer<span class=\"token punctuation\">.</span>delivery_method <span class=\"token operator\">=</span> <span class=\"token symbol\">:smtp</span>\nconfig<span class=\"token punctuation\">.</span>action_mailer<span class=\"token punctuation\">.</span>smtp_settings <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  address<span class=\"token punctuation\">:</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"SMTP_HOST\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  port<span class=\"token punctuation\">:</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"SMTP_PORT\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>本番環境などでは、この環境変数を実際に運用するSMTPサーバーのものに替えるだけでいい。</p>","fileAbsolutePath":"/home/circleci/project/contents/posts/21.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"b4c2383a-5bc8-59cd-85ca-5820647879f6"}}}
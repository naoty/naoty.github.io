{"componentChunkName":"component---src-templates-post-jsx","path":"/posts/51.html","webpackCompilationHash":"7611f57c1c47d2c37259","result":{"data":{"site":{"siteMetadata":{"rootURL":"https://naoty.github.io"}},"markdownRemark":{"frontmatter":{"title":"Circle CIからHeroku registryにpushする","time":"2018-12-16T22:44:00+0900","description":null,"tags":["circleci"]},"html":"<p>DockerコンテナをHeroku上で実行したい場合、Heroku registryにDockerイメージをpushすることになる。これをCircle CIで行いたい。</p>\n<p>Heroku registryの認証はHeroku CLIか<code class=\"language-text\">docker login</code>コマンドで行うことができるが、Heroku CLIのセットアップを\"Docker in Docker\"イメージ（ベースがalpine）上で行うのはけっこうたいへんなので、以下のように<code class=\"language-text\">docker login</code>コマンドから行うと良い。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker login -u _ -p <span class=\"token variable\">$HEROKU_API_KEY</span> registry.heroku.com</code></pre></div>\n<p><code class=\"language-text\">$HEROKU_API_KEY</code>は<code class=\"language-text\">heroku auth:token</code>コマンドで取得したトークンを環境変数で設定しておく。</p>\n<p><code class=\"language-text\">.circle/config.yml</code>はこんな感じになる。</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># ...</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Push image to Heroku registry\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n        docker login -u _ -p $HEROKU_API_KEY registry.heroku.com\n        docker tag myapp registry.heroku.com/$HEROKU_APP/web/myapp\n        docker push registry.heroku.com/$HEROKU_APP/web/myapp</span></code></pre></div>","fileAbsolutePath":"/home/circleci/project/contents/posts/51.md"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"17c048f6-07b2-53d8-80e9-5baa4c9498dd"}}}